# 🚗 Pickup Route Optimization

## 📋 概要
このプロジェクトは、Google スプレッドシートと Google Apps Script を使用して送迎ルートを最適化するツールです。複数の送迎先を効率的に回るルートを Google Maps API を利用して計算し、訪問順序や到着予定時刻を自動で算出します。

## ✨ 機能
- 🗺️ 複数の訪問先の最適な巡回ルートを計算
- 📍 特定の場所を最初または最後に訪問するよう指定可能
- 🕒 各訪問先への到着予定時刻の算出
- 🌐 最適化されたルートを Google Maps で表示

## 📝 使用方法

### 1️⃣ スプレッドシートの準備
以下の形式でスプレッドシートを作成します：

| 事務所の場所 | 送迎開始時刻 | 利用者氏名 | 利用者住所住所 | 送迎有無 | 最初に送迎 | 最後に送迎 | 送迎順 | 到着予定時刻 | 前宅からの所要時間 |
|------------|------------|----------|-------------|--------|----------|----------|-------|-----------|----------------|
| 東京都文京区本郷7-3-1 | 2026/03/09 | 田中太郎 | 東京都目黒区駒場3-8-1 | □ | □ | □ | 自動入力 | 自動入力 | 自動入力 |
|  |  | 山田花子 | 東京都文京区本駒込1-1-1 | □ | □ | □ | 自動入力 | 自動入力 | 自動入力 |
|  |  | 佐藤健太 | 東京都新宿区西早稲田3-9-7 | □ | □ | □ | 自動入力 | 自動入力 | 自動入力 |
|  |  | 鈴木美咲 | 東京都世田谷区桜上水4-1-12 | □ | □ | □ | 自動入力 | 自動入力 | 自動入力 |
|  |  | 高橋誠 | 東京都渋谷区神宮前1-5-8 | □ | □ | □ | 自動入力 | 自動入力 | 自動入力 |

### 2️⃣ 入力項目の説明
- 🏢 **事務所の場所 (A2)**: 出発地点および最終帰着地点の住所
- ⏰ **送迎開始時刻 (B2)**: 出発時刻（空白の場合は現在時刻を使用）
- 👤 **利用者氏名 (C列)**: 送迎する人の名前
- 🏠 **利用者住所住所 (D列)**: 送迎先の住所
- ✅ **送迎有無 (E列)**: チェックを入れると送迎対象になります
- 1️⃣ **最初に送迎 (F列)**: チェックを入れるとその住所を最初に訪問します（1ヶ所のみ指定可能）
- 🔚 **最後に送迎 (G列)**: チェックを入れるとその住所を最後に訪問します（1ヶ所のみ指定可能）

### 3️⃣ スクリプトの設定
1. Google スプレッドシートで「拡張機能」→「Apps Script」を開く
2. [main.gs](main.gs)のコードをコピーして貼り付ける
3. Google Maps API キーを設定:
   - スクリプトエディタの「ファイル」→「プロジェクトのプロパティ」→「スクリプトのプロパティ」
   - 名前に「MAPS_API_KEY」、値に取得した API キーを入力して保存

### 4️⃣ 実行方法
1. スプレッドシートに戻り、カスタムメニューから「経路最適化」→「ルート計算実行」をクリック
2. 初回実行時は権限の承認が必要です
3. 計算が完了すると以下の列が自動入力されます：
   - 🔢 **送迎順 (H列)**: 訪問する順番
   - 🕒 **到着予定時刻 (I列)**: 各訪問先への予想到着時刻
   - ⏱️ **前宅からの所要時間 (J列)**: 前の訪問先からの移動時間

### 5️⃣ Google Maps で確認
計算完了後、「Google Maps を開く」ボタンをクリックすると最適化されたルートが Google Maps で表示されます。

## ⚠️ 注意事項
- 🔟 最大 10 件までの訪問先に対応しています
- ☑️ 「送迎有無」にチェックがない行は計算に含まれません
- 🔂 「最初に送迎」「最後に送迎」は各1件のみ指定可能です
- 🔑 有効な Google Maps API キーが必要です（[取得方法](https://developers.google.com/maps/documentation/javascript/get-api-key)）

## 🔧 トラブルシューティング
- ❓ **API エラー**: API キーが正しく設定されているか確認してください
- 🏡 **住所エラー**: 住所が正確に入力されているか確認してください
- ⚠️ **バリデーションエラー**: 表示されるエラーメッセージに従って入力を修正してください